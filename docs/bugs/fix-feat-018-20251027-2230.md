# Fix Report: feat-018 - Criar AuthService com l√≥gica de autentica√ß√£o

**Data do Ajuste:** 2025-10-27 22:30
**Tipo:** üêõ Bug Cr√≠tico

---

## 1. PROBLEMA ORIGINAL

### Descri√ß√£o do Problema
Ao tentar realizar o login na aplica√ß√£o, o backend retornava um erro interno e a aplica√ß√£o quebrava, impedindo qualquer usu√°rio de se autenticar. O log do servidor exibia o erro `Error: secretOrPrivateKey must have a value`.

### Contexto
- **Reportado por:** Desenvolvedor (via log de erro)
- **Ambiente:** Desenvolvimento
- **Impacto:** Cr√≠tico - A funcionalidade principal de login estava completamente inoperante.

### Comportamento Esperado
O usu√°rio deveria conseguir fazer login com credenciais v√°lidas e receber um token JWT de acesso.

### Comportamento Observado
A API retornava um erro 500 e o log indicava que a chave secreta do JWT n√£o estava sendo fornecida para a fun√ß√£o de assinatura do token.

---

## 2. AN√ÅLISE DA CAUSA RAIZ

### Investiga√ß√£o
A an√°lise do stack trace apontou para o arquivo `backend/src/services/auth.service.js`, especificamente na chamada `jwt.sign()`. Foi verificado que a vari√°vel usada para a chave secreta estava `undefined`. A investiga√ß√£o ent√£o se voltou para a importa√ß√£o e uso das configura√ß√µes de autentica√ß√£o.

### Causa Identificada
O arquivo `backend/src/config/auth.js` exporta um objeto contendo m√∫ltiplas configura√ß√µes, entre elas `jwtConfig`. No entanto, o `auth.service.js` estava importando o m√≥dulo inteiro (`const authConfig = require(...)`) e tentando usar `authConfig.secret`, que n√£o existe. O correto seria desestruturar `jwtConfig` da importa√ß√£o (`const { jwtConfig } = require(...)`) e usar `jwtConfig.secret`.

### Arquivos/Componentes Afetados
- `backend/src/services/auth.service.js` - Era o local do bug, onde a configura√ß√£o era consumida de forma incorreta.

---

## 3. SOLU√á√ÉO IMPLEMENTADA

### Estrat√©gia de Corre√ß√£o
A corre√ß√£o consistiu em ajustar a forma como as configura√ß√µes de JWT s√£o importadas e utilizadas dentro do `AuthService`, garantindo que a chave secreta e o tempo de expira√ß√£o corretos sejam passados para as fun√ß√µes do `jsonwebtoken`.

### Mudan√ßas Realizadas

#### Backend
- A importa√ß√£o em `auth.service.js` foi alterada de `const authConfig = require('../config/auth');` para `const { jwtConfig } = require('../config/auth');`.
- Todas as ocorr√™ncias de `authConfig.secret` foram substitu√≠das por `jwtConfig.secret`.
- Todas as ocorr√™ncias de `authConfig.expiresIn` foram substitu√≠das por `jwtConfig.accessExpiresIn` para refletir o nome correto da propriedade definida no objeto de configura√ß√£o.
- Adicionado um coment√°rio de `FIX` no c√≥digo para documentar a mudan√ßa.

---

## 4. ARQUIVOS MODIFICADOS

### auth.service.js
**Caminho:** `backend/src/services/auth.service.js`

**Mudan√ßas:**
- ‚úÖ Corrigida a importa√ß√£o das configura√ß√µes de autentica√ß√£o para desestruturar `jwtConfig`.
- ‚úÖ Substitu√≠do o uso de `authConfig.secret` por `jwtConfig.secret`.
- ‚úÖ Substitu√≠do o uso de `authConfig.expiresIn` por `jwtConfig.accessExpiresIn`.

**C√≥digo Relevante:**
```javascript
const { jwtConfig } = require('../config/auth');

// ...

    /**
     * FIX: [secretOrPrivateKey must have a value]
     * 
     * Problema: [A configura√ß√£o do JWT estava sendo importada incorretamente. `authConfig.secret` era undefined.]
     * Solu√ß√£o: [Desestruturar `jwtConfig` do `require('../config/auth')` e usar `jwtConfig.secret` e `jwtConfig.accessExpiresIn`.]
     * Data: [2025-10-27]
     */
    const token = jwt.sign({ id: user.id, role: user.role }, jwtConfig.secret, {
      expiresIn: jwtConfig.accessExpiresIn,
    });
```

---

**Ajuste conclu√≠do em:** 2025-10-27 22:30
**Revisado por:** Gemini
