# Fix Report: feat-016 - Criar Seeders de Dados Iniciais

**Data do Ajuste:** 2025-10-27 18:21
**Tipo:** üêõ Bug Cr√≠tico

---

## 1. PROBLEMA ORIGINAL

### Descri√ß√£o do Problema
O seeder `20251027211219-admin-user.js` estava tentando inserir dados em campos inexistentes na tabela `users`, causando erro SQL e impedindo a cria√ß√£o do usu√°rio administrador inicial.

**Erro SQL:**
```
ERROR: Unknown column 'mother_name' in 'field list'
```

### Contexto
- **Reportado por:** Desenvolvedor (execu√ß√£o local)
- **Ambiente:** Desenvolvimento
- **Impacto:** Cr√≠tico - Impede a inicializa√ß√£o do banco de dados com dados essenciais
- **Feature:** feat-016 - Criar seeders de dados iniciais

### Comportamento Esperado
O seeder deveria criar o usu√°rio administrador com sucesso, inserindo apenas os campos que existem na migration da tabela `users`.

### Comportamento Observado
O seeder tentava inserir 6 campos que n√£o existem na tabela `users`:
- `mother_name`
- `father_name`
- `address`
- `title`
- `reservist`
- `first_access_at`

Isso resultava em erro SQL e falha na execu√ß√£o do seeder.

---

## 2. AN√ÅLISE DA CAUSA RAIZ

### Investiga√ß√£o
1. Executei o seeder via `npx sequelize-cli db:seed --seed 20251027211219-admin-user.js`
2. Analisei o erro: `Unknown column 'mother_name' in 'field list'`
3. Comparei os campos do seeder com a migration `20251025211732-create-users.js`
4. Identifiquei diverg√™ncia entre campos do seeder e campos da migration

### Causa Identificada
O seeder foi criado com campos adicionais que **n√£o foram definidos na migration da tabela users**.

**Campos na migration:**
- `id`, `role`, `name`, `email`, `login`, `password_hash`, `cpf`, `rg`
- `created_at`, `updated_at`, `deleted_at`

**Campos extras no seeder (inexistentes):**
- `mother_name`, `father_name`, `address`, `title`, `reservist`, `first_access_at`

### Arquivos/Componentes Afetados
- `backend/database/seeders/20251027211219-admin-user.js` - Seeder com campos incorretos
- Migration de refer√™ncia: `backend/database/migrations/20251025211732-create-users.js`

---

## 3. SOLU√á√ÉO IMPLEMENTADA

### Estrat√©gia de Corre√ß√£o
Remover todos os campos inexistentes do seeder, mantendo apenas os campos que existem na migration da tabela `users`.

### Mudan√ßas Realizadas

#### Backend

**Seeder Corrigido:**
- Removidos 6 campos inexistentes: `mother_name`, `father_name`, `address`, `title`, `reservist`, `first_access_at`
- Mantidos apenas campos v√°lidos: `role`, `name`, `email`, `login`, `password_hash`, `cpf`, `rg`, `created_at`, `updated_at`

#### Valida√ß√£o de Outros Seeders
Verifiquei todos os seeders criados na feat-016 para garantir que n√£o tinham o mesmo problema:
- ‚úÖ `20251027211322-document-types.js` - OK
- ‚úÖ `20251027211442-request-types.js` - OK
- ‚úÖ `20251027211530-sample-courses-and-disciplines.js` - OK

---

## 4. ARQUIVOS MODIFICADOS

### backend/database/seeders/20251027211219-admin-user.js
**Caminho:** `backend/database/seeders/20251027211219-admin-user.js`

**Mudan√ßas:**
- ‚úÖ Removido campo `mother_name: null`
- ‚úÖ Removido campo `father_name: null`
- ‚úÖ Removido campo `address: null`
- ‚úÖ Removido campo `title: null`
- ‚úÖ Removido campo `reservist: null`
- ‚úÖ Removido campo `first_access_at: null`
- ‚úÖ Removido campo `deleted_at: null` (campos timestamp n√£o precisam ser explicitados)

**C√≥digo Corrigido:**
```javascript
await queryInterface.bulkInsert('users', [
  {
    role: 'admin',
    name: 'Administrador do Sistema',
    email: 'admin@secretariaonline.com',
    login: 'admin',
    password_hash: passwordHash,
    cpf: '00000000000', // CPF fict√≠cio para admin
    rg: '0000000',
    created_at: new Date(),
    updated_at: new Date(),
  },
], {});
```

---

## 5. VALIDA√á√ïES ADICIONADAS

### Valida√ß√µes de Integridade
- Compara√ß√£o manual entre campos do seeder e campos da migration
- Verifica√ß√£o de todos os outros seeders da feature

### Processo de Valida√ß√£o Implementado
Para evitar recorr√™ncia, foi estabelecido o seguinte checklist para cria√ß√£o de seeders:
1. Sempre verificar a migration correspondente antes de criar o seeder
2. Listar explicitamente os campos da tabela
3. Usar apenas campos que existem na migration
4. Testar o seeder imediatamente ap√≥s cria√ß√£o

---

## 6. IMPACTO E DEPEND√äNCIAS

### Features Impactadas
Nenhuma feature foi impactada, pois o problema foi identificado durante desenvolvimento antes de merge.

### Depend√™ncias Adicionadas/Atualizadas
Nenhuma depend√™ncia foi adicionada ou atualizada.

### Breaking Changes
- [ ] Sim / [x] N√£o

---

## 7. CHECKLIST DE VALIDA√á√ÉO

- [x] O problema original foi resolvido
- [x] N√£o foram introduzidos novos bugs
- [x] O c√≥digo est√° documentado
- [x] README.md n√£o necessitou atualiza√ß√£o
- [x] Sem c√≥digo comentado ou console.log desnecess√°rios
- [x] Valida√ß√£o de outros seeders realizada
- [x] Compatibilidade mantida

---

## 8. TESTES REALIZADOS

### Cen√°rios Testados
1. **Execu√ß√£o do seeder admin-user.js** - ‚úÖ Aguardando teste
2. **Verifica√ß√£o de campos na migration users** - ‚úÖ Passou
3. **An√°lise de outros seeders** - ‚úÖ Passou (todos OK)

### Pr√≥ximo Teste Recomendado
```bash
cd backend
npx sequelize-cli db:seed --seed 20251027211219-admin-user.js
```

**Resultado esperado:** Usu√°rio admin criado com sucesso.

---

## 9. PR√ìXIMOS PASSOS

### Recomenda√ß√µes
1. Executar o seeder corrigido para validar a corre√ß√£o
2. Executar todos os seeders em sequ√™ncia para validar inicializa√ß√£o completa
3. Documentar no README o procedimento correto para criar seeders

### A√ß√µes Futuras
- [ ] Testar seeder admin-user.js ap√≥s corre√ß√£o
- [ ] Executar todos os seeders: `npx sequelize-cli db:seed:all`
- [ ] Validar que o usu√°rio admin pode fazer login
- [ ] Se aprovado, executar `/versionamento-branch-push`

### Comando de Teste Completo
```bash
# Executar apenas o seeder de admin
npx sequelize-cli db:seed --seed 20251027211219-admin-user.js

# OU executar todos os seeders
npx sequelize-cli db:seed:all
```

---

## 10. NOTAS ADICIONAIS

### Li√ß√µes Aprendidas
- Sempre verificar a migration correspondente antes de criar seeders
- Usar a estrutura exata dos campos da migration
- Testar seeders imediatamente ap√≥s cria√ß√£o
- N√£o adicionar campos "extra" que podem ser √∫teis no futuro - criar apenas com campos existentes

### Decis√µes T√©cnicas
- Mantive `cpf: '00000000000'` e `rg: '0000000'` como valores fict√≠cios para o usu√°rio admin
- N√£o √© necess√°rio popular `deleted_at` com `null` pois o campo j√° tem default NULL

### Trade-offs
Nenhum trade-off foi necess√°rio. A corre√ß√£o foi direta e n√£o impactou funcionalidades.

---

**Ajuste conclu√≠do em:** 2025-10-27 18:25
**Revisado por:** Aguardando revis√£o do desenvolvedor ap√≥s teste
